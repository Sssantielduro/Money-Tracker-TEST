<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Santi Money Tracker</title>
  <link rel="stylesheet" href="style.css" />

  <!-- ðŸ”¥ Firebase Setup -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import {
      getAuth,
      onAuthStateChanged,
      signInWithPopup,
      GoogleAuthProvider,
      signOut,
      signInWithRedirect,
      getRedirectResult,
    } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
    import { getFirestore } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBggmaF4r5_6jay4k_EEAd3WTBUBhQT86Y",
      authDomain: "money-tracker-19180.firebaseapp.com",
      projectId: "money-tracker-19180",
      storageBucket: "money-tracker-19180.firebasestorage.app",
      messagingSenderId: "410840275432",
      appId: "1:410840275432:web:0e5f33f7e3380cf31b6c5d",
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    window.firebaseAuth = auth;
    window.firebaseDb = db;
    window.GoogleAuthProvider = GoogleAuthProvider;
    window.signInWithPopup = signInWithPopup;
    window.signInWithRedirect = signInWithRedirect;
    window.getRedirectResult = getRedirectResult;
    window.signOutFirebase = signOut;
    window.onFirebaseAuthStateChanged = onAuthStateChanged;
  </script>

  <!-- Plaid Link SDK -->
  <script src="https://cdn.plaid.com/link/v2/stable/link-initialize.js"></script>
</head>
<body>
  <div class="app">
    <h1><span class="accent">Santi</span> Money Tracker</h1>
    <p class="subtitle">CFO brain for your cash, credit, and plays.</p>

    <!-- AUTH BAR -->
    <div class="auth-bar">
      <div class="auth-bar-left">
        <span id="auth-status">Not signed in</span>
        <button id="google-login">Sign in with Google</button>
        <button id="logout" style="display:none;">Log out</button>
      </div>
      <button id="profile-btn" class="profile-btn" style="display:none;">
        Profile
      </button>
    </div>

    <!-- EXTRA AUTH OPTIONS (Email + Phone) -->
    <div class="auth-extra">
      <!-- Email / Password -->
      <div class="auth-card">
        <h2>Email login</h2>
        <input
          id="email"
          type="email"
          placeholder="Email"
          autocomplete="username"
        />
        <input
          id="password"
          type="password"
          placeholder="Password"
          autocomplete="current-password"
        />
        <div class="auth-buttons-row">
          <button id="email-signup">Create account</button>
          <button id="email-login">Log in</button>
        </div>
      </div>

      <!-- Phone -->
      <div class="auth-card">
        <h2>Phone login</h2>
        <input
          id="phone"
          type="tel"
          placeholder="Phone #"
        />
        <button id="send">Send</button>

        <input
          id="code"
          type="text"
          placeholder="Code"
        />
        <button id="verify">Verify</button>

        <div id="recaptcha-container"></div>
      </div>
    </div>

    <!-- ðŸ‘‡ Only visible when logged in -->
    <div id="authed-area" style="display:none;">
      <!-- Nav tabs for views -->
      <div class="nav-tabs">
        <button id="tab-dashboard" class="nav-tab nav-tab-active">Dashboard</button>
        <button id="tab-transactions" class="nav-tab">Transactions</button>
        <button id="tab-lab" class="nav-tab">Lab</button>
        <button id="tab-budget" class="nav-tab">Budget</button>
        <button id="tab-accounting" class="nav-tab">Accounting</button>
      </div>

      <!-- DASHBOARD VIEW -->
      <div id="view-dashboard" class="view">
        <!-- Capital Power summary -->
        <div class="summary-card">
          <div class="summary-main">
            <h2>Capital Power</h2>
            <p id="capital-total">$0.00</p>
          </div>
          <div class="summary-subgrid">
            <div class="summary-pill">
              <span class="pill-label">Liquid</span>
              <span id="capital-liquid">$0.00</span>
            </div>
            <div class="summary-pill">
              <span class="pill-label">Credit Power</span>
              <span id="capital-credit">$0.00</span>
            </div>
            <div class="summary-pill">
              <span class="pill-label">Solid Power</span>
              <span id="capital-solid">$0.00</span>
            </div>
            <div class="summary-pill">
              <span class="pill-label">Net Worth</span>
              <span id="capital-net">$0.00</span>
            </div>
          </div>
          <div class="summary-actions">
            <button id="connect-bank">Connect Bank</button>
          </div>
        </div>

        <!-- Asset accounts snapshot (Plaid) -->
        <div class="section">
          <div class="accounts-header">
            <h2>Accounts Snapshot</h2>
            <button id="refresh-accounts">Refresh Accounts</button>
          </div>
          <p id="accounts-total">Total (Banks): $0.00</p>
          <ul id="accounts-list"></ul>
        </div>

        <!-- Add Transaction (manual cash / plays) -->
        <div class="section">
          <h2>Add Item (Manual)</h2>
          <form id="tx-form">
            <input
              id="label"
              type="text"
              placeholder="Label (Cash, Savings, Rent, BTC, etc.)"
              required
            />
            <input
              id="amount"
              type="number"
              step="0.01"
              placeholder="Amount"
              required
            />
            <select id="type">
              <option value="asset">Asset (+)</option>
              <option value="liability">Liability (-)</option>
              <option value="income">Income (+)</option>
              <option value="expense">Expense (-)</option>
            </select>
            <button type="submit">Add</button>
          </form>
        </div>

        <!-- Manual Breakdown -->
        <div class="section">
          <h2>Manual Breakdown</h2>
          <ul id="tx-list"></ul>
        </div>

        <!-- Plaid Transactions -->
        <div class="section">
          <div class="accounts-header">
            <h2>Bank Activity (Plaid)</h2>
            <button id="refresh-plaid-tx">Refresh Bank Activity</button>
          </div>
          <ul id="plaid-tx-list"></ul>
        </div>
      </div>

      <!-- TRANSACTIONS / LEDGER VIEW -->
      <div id="view-transactions" class="view" style="display:none;">
        <div class="section">
          <div class="transactions-header">
            <div>
              <h2>Universal Transactions Ledger</h2>
              <p class="subtitle small">
                All flows across cash, banks, credit, and plays in one stream.
              </p>
            </div>
          </div>

          <div class="tx-layout">
            <!-- LEFT: ENTRY PANEL -->
            <div class="tx-form-panel">
              <h3>New Manual Transaction</h3>
              <form id="ledger-form">
                <div class="form-row">
                  <input id="ledger-date" type="date" required />
                  <input
                    id="ledger-label"
                    type="text"
                    placeholder="Label (Uber Eats, Rent, BTC flip...)"
                    required
                  />
                </div>

                <div class="form-row">
                  <input
                    id="ledger-amount"
                    type="number"
                    step="0.01"
                    placeholder="Amount"
                    required
                  />
                  <select id="ledger-type">
                    <option value="expense">Expense (money out)</option>
                    <option value="income">Income (money in)</option>
                    <option value="transfer">Transfer / move</option>
                    <option value="adjustment">Adjustment</option>
                  </select>
                </div>

                <div class="form-row">
                  <input
                    id="ledger-from"
                    type="text"
                    placeholder="From account (Cash, Amex, Dad, Inventory...)"
                  />
                  <input
                    id="ledger-to"
                    type="text"
                    placeholder="To account (Savings, Rent, Inventory...)"
                  />
                </div>

                <div class="form-row">
                  <input
                    id="ledger-platform"
                    type="text"
                    placeholder="Platform / channel (Zelle, Cash, Robinhood...)"
                  />
                  <input
                    id="ledger-tags"
                    type="text"
                    placeholder="Tags (comma, separated: rent, flip, gas)"
                  />
                </div>

                <textarea
                  id="ledger-note"
                  rows="2"
                  placeholder="Notes (why, who, terms, etc...)"
                ></textarea>

                <button type="submit">Add to ledger</button>
              </form>
            </div>

            <!-- RIGHT: TABLE / FEED PANEL -->
            <div class="tx-table-panel">
              <div class="tx-filter-bar">
                <select id="ledger-source-filter">
                  <option value="all">All sources</option>
                  <option value="manual">Manual only</option>
                  <option value="bank">Bank / Plaid</option>
                </select>

                <select id="ledger-type-filter">
                  <option value="all">All types</option>
                  <option value="income">Income</option>
                  <option value="expense">Expense</option>
                  <option value="transfer">Transfers</option>
                  <option value="adjustment">Adjustments</option>
                </select>

                <select id="ledger-sort">
                  <option value="date-desc">Newest first</option>
                  <option value="date-asc">Oldest first</option>
                  <option value="amount-desc">Amount high â†’ low</option>
                  <option value="amount-asc">Amount low â†’ high</option>
                </select>

                <input
                  id="ledger-search"
                  type="text"
                  placeholder="Search label / account / tag"
                />
              </div>

              <ul id="ledger-list" class="ledger-list"></ul>
            </div>
          </div>
        </div>
      </div>

      <!-- LAB VIEW -->
      <div id="view-lab" class="view" style="display:none;">
        <div class="section">
          <h2>Lab</h2>
          <p class="subtitle small">
            Sandbox for future analytics, simulations, and wild experiments.
          </p>
          <p style="font-size:13px; color:#9ca3af;">
            This will be where you test projections, deal simulations, and advanced plays.
          </p>
        </div>
      </div>

      <!-- BUDGET VIEW -->
      <div id="view-budget" class="view" style="display:none;">
        <div class="section">
          <h2>Budget Panel</h2>
          <p class="subtitle small">
            How your spending stacks against your caps.
          </p>
          <ul id="budget-list"></ul>
        </div>
      </div>

      <!-- ACCOUNTING VIEW -->
      <div id="view-accounting" class="view" style="display:none;">
        <div class="section">
          <h2>Accounting View</h2>
          <p class="subtitle small">
            High-level chart of accounts from Plaid + your manual plays.
          </p>

          <div class="accounting-grid">
            <div class="panel">
              <h3>Accounts (Assets & Liabilities)</h3>
              <ul id="coa-list"></ul>
            </div>
            <div class="panel">
              <h3>Simple Trial Balance</h3>
              <div id="trial-balance"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- PROFILE VIEW (opens via Profile button) -->
      <div id="view-profile" class="view" style="display:none;">
        <div class="section profile-section">
          <h2>Profile</h2>
          <p id="profile-email">Email: â€”</p>
          <p id="profile-uid">UID: â€”</p>

          <div class="profile-links">
            <h3>Linked Services</h3>
            <ul>
              <li>Firebase Auth (Google / Email / Phone)</li>
              <li>Plaid Bank Connections</li>
              <li>Future: Credit bureaus / accounts</li>
            </ul>
          </div>

          <div class="profile-actions">
            <button disabled>Manage Auth (coming soon)</button>
            <button disabled>Export Data (coming soon)</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Main App Logic -->
  <script type="module" src="app.js"></script>
</body>
</html>
